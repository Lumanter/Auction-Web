<%- include('../partials/header'); %>

<div class="container mt-3">
    <div class="card">
        <div class="card-body">
            <% if (isclosed) { %>
                <h2 class="alert alert-secondary">CLOSED</h2>
            <% } %>

            <% if (itemphoto) { %>
                <img src="data:image/jpeg;base64,<%= new Buffer.from(itemphoto).toString('base64') %>">
            <% } %>
        
            <h2 clas><%= itemname %></h2>
            <p><strong>Subcategory:</strong> <%= subcategoryname %></p>
            <p><strong>Description:</strong> <%= itemdescription %></p>
            <p><strong>Delivery details:</strong> <%= deliverydetails %></p>
            <p><strong>Base Price:</strong> ₡<%= baseprice %></p>
            <p>Active from <em><%= startdate.split(' ')[0] %></em> to <em><%= enddate.split(' ')[0] %></em> at <em><%= enddate.split(' ')[1] %></em></p>

            <div style="text-align: center">
                <% if (isclosed) { %>
                    <h3 class="font-weight-normal">Final price: <strong>₡<%= currentprice %></strong></h3>
                <% } else { %>
                    <h3 class="font-weight-normal">Current price: <strong>₡<%= currentprice %></strong></h3>
                    <p>Minimum bid: ₡<%= minbid %></p>
                <% }  %>
            </div>
            
            <small><em>Created by <a href="/users/<%= sellerid %>"><%= sellernickname %></a></em></small>
        </div>
    </div>

    <% if (!isclosed && user.id != sellerid) { %>
        <div class="row justify-content-center mt-2">
            <form class="form-inline" action="/auctions/<%= auctionid %>" method="POST">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">₡</span>
                    </div>
                    <input id="bidamount" type="number" class="form-control" aria-label="bidamount" name="bidamount" value='<%= minbid %>' required />
                </div>
                <button class="btn btn-outline-info ml-2" type="submit">Bid</button>
            <form>
        </div>
    <% } %>

    <% if (bids !== []) { %>
        <div class="row justify-content-center mt-2">
            <ul class="list-group">
                <% bids.forEach((bid) => { %>
                    <p class="list-group-item list-group-item-action">
                        <a href="/users/<%= bid.userid %>"><%= bid.nickname %></a> bid <strong>₡<%= bid.amount %></strong>
                        <small><em>(<%= bid.date.split(' ')[0] %> at <%= bid.date.split(' ')[1].slice(0, -7) %>)</em></small>
                    </p>
                <% }); %>
            </ul>
        </div>
    <% } %>

</div>

<%- include('../partials/footer'); %>